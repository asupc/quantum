(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1aec31ba"],{"0f37":function(t,e,a){"use strict";a.d(e,"a",(function(){return i}));var n=a("66df"),i=function(){return n["a"].request({url:"/api/Enum",method:"get"})}},"1a87":function(t,e,a){"use strict";a("9e72")},"469e":function(t,e,a){},5888:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t._self._c;return e("div",[e("div",[e("Form",{attrs:{"label-width":80},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.LoadTask(1))}}},[e("Row",[e("Col",{attrs:{span:"4"}},[e("FormItem",{attrs:{label:"搜索"}},[e("Input",{attrs:{placeholder:"输入搜索关键字"},model:{value:t.QueryForm.Key,callback:function(e){t.$set(t.QueryForm,"Key",e)},expression:"QueryForm.Key"}})],1)],1),e("Col",{attrs:{span:"4"}},[e("FormItem",{attrs:{label:"状态"}},[e("Select",{attrs:{clearable:""},on:{"on-change":function(e){return t.LoadTask(1)}},model:{value:t.QueryForm.Enable,callback:function(e){t.$set(t.QueryForm,"Enable",e)},expression:"QueryForm.Enable"}},[e("Option",{attrs:{value:"true"}},[t._v("启用")]),e("Option",{attrs:{value:"false"}},[t._v("禁用")])],1)],1)],1),t._v(" \n        "),e("Button",{attrs:{type:"info"},on:{click:function(e){return t.LoadTask(1)}}},[e("Icon",{attrs:{type:"md-search"}}),t._v(" 搜索\n        ")],1)],1)],1)],1),e("div",{staticStyle:{margin:"20px 0"}},[e("Button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.editTask(-1)}}},[e("Icon",{attrs:{type:"md-add"}}),t._v(" 添加\n    ")],1),t._v("\n     \n    "),e("Button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.enableSelection()}}},[e("Icon",{attrs:{type:"md-cog"}}),t._v(" 启用\n    ")],1),t._v("\n     \n    "),e("Button",{attrs:{type:"warning",size:"small"},on:{click:function(e){return t.disableSelection()}}},[e("Icon",{attrs:{type:"md-cog"}}),t._v(" 禁用\n    ")],1),t._v("\n     \n    "),e("Button",{attrs:{type:"error",size:"small"},on:{click:function(e){return t.deleteSelection()}}},[e("Icon",{attrs:{type:"ios-trash"}}),t._v(" 删除\n    ")],1)],1),e("Table",{ref:"EnvTable",attrs:{stripe:"",border:"",columns:t.TaskColumns,data:t.CommadnData}}),e("div",{staticStyle:{margin:"10px",overflow:"hidden"}},[e("div",{staticStyle:{float:"right"}},[e("Page",{attrs:{total:t.PageInfo.Total,current:t.QueryForm.PageIndex,"page-size":t.QueryForm.PageSize,"page-size-opts":t.PageInfo.PageSizeOpts,"show-sizer":!0,"show-total":!0},on:{"on-page-size-change":t.pageSizeChange,"on-change":t.LoadTask}})],1)]),e("Modal",{attrs:{"mask-closable":!1,title:t.EditTaskModal.Title,width:800},model:{value:t.EditTaskModal.Show,callback:function(e){t.$set(t.EditTaskModal,"Show",e)},expression:"EditTaskModal.Show"}},[e("Form",{ref:"editTaskForm",attrs:{model:t.EditTaskModal.Data,rules:t.ruleValidate,"label-width":80}},[e("FormItem",{attrs:{label:"名称",prop:"Name"}},[e("Input",{model:{value:t.EditTaskModal.Data.Name,callback:function(e){t.$set(t.EditTaskModal.Data,"Name",e)},expression:"EditTaskModal.Data.Name"}})],1),e("FormItem",{attrs:{label:"密钥",prop:"Secret"}},[e("Input",{attrs:{maxlength:30,placeholder:"验证和匹配触发执行脚本的标识，不能重复，建议复杂度高一点，OK？"},model:{value:t.EditTaskModal.Data.Secret,callback:function(e){t.$set(t.EditTaskModal.Data,"Secret",e)},expression:"EditTaskModal.Data.Secret"}})],1),e("FormItem",{attrs:{label:"触发方式",prop:"HttpMethod"}},[e("Select",{attrs:{clearable:""},model:{value:t.EditTaskModal.Data.HttpMethod,callback:function(e){t.$set(t.EditTaskModal.Data,"HttpMethod",e)},expression:"EditTaskModal.Data.HttpMethod"}},t._l(t.HttpMethods,(function(a){return e("Option",{key:a.Value,attrs:{value:a.Value}},[t._v("\n            "+t._s(a.Key)+"\n          ")])})),1)],1),e("FormItem",{attrs:{label:"触发地址"}},[e("Input",{attrs:{readonly:"",value:t.getTriggerUrl}})],1),e("FormItem",{attrs:{label:"执行脚本",prop:"SrciptFile"}},[e("Input",{model:{value:t.EditTaskModal.Data.SrciptFile,callback:function(e){t.$set(t.EditTaskModal.Data,"SrciptFile",e)},expression:"EditTaskModal.Data.SrciptFile"}},[e("Upload",{attrs:{slot:"append","show-upload-list":!1,"on-success":t.onSuccess,action:t.BaseUrl+"/api/Upload/scripts?dir="+t.FileNameDir+"/"+t.ScriptSubDir,headers:t.UploadHeaders},slot:"append"},[e("i-button",{attrs:{icon:"ios-cloud-upload-outline"}},[t._v("上传脚本")])],1)],1)],1),e("FormItem",{attrs:{label:"白名单IP"}},[e("Input",{attrs:{type:"textarea",placeholder:"验证来源IP，不设置则验证，多个用逗号隔开或换行"},model:{value:t.EditTaskModal.Data.Whitelist,callback:function(e){t.$set(t.EditTaskModal.Data,"Whitelist",e)},expression:"EditTaskModal.Data.Whitelist"}})],1),e("FormItem",{attrs:{label:"备注"}},[e("Input",{attrs:{type:"textarea"},model:{value:t.EditTaskModal.Data.Remark,callback:function(e){t.$set(t.EditTaskModal.Data,"Remark",e)},expression:"EditTaskModal.Data.Remark"}})],1),e("FormItem",{attrs:{label:"开关选项"}},[e("Checkbox",{model:{value:t.EditTaskModal.Data.Enable,callback:function(e){t.$set(t.EditTaskModal.Data,"Enable",e)},expression:"EditTaskModal.Data.Enable"}},[t._v("\n          启用\n          "),e("Tooltip",{attrs:{content:"全局开关，是否启用",placement:"top"}},[e("Icon",{attrs:{type:"ios-alert"}})],1)],1),e("Checkbox",{model:{value:t.EditTaskModal.Data.EnablePush,callback:function(e){t.$set(t.EditTaskModal.Data,"EnablePush",e)},expression:"EditTaskModal.Data.EnablePush"}},[t._v("\n          消息推送"),e("Tooltip",{attrs:{content:"允许脚本发送通知消息",placement:"top"}},[e("Icon",{attrs:{type:"ios-alert"}})],1)],1),e("Checkbox",{model:{value:t.EditTaskModal.Data.EnableProxy,callback:function(e){t.$set(t.EditTaskModal.Data,"EnableProxy",e)},expression:"EditTaskModal.Data.EnableProxy"}},[t._v("\n          代理"),e("Tooltip",{attrs:{content:"仅支持使用quantum.js 中 api 方法请求接口的脚本",placement:"top","max-width":"400"}},[e("Icon",{attrs:{type:"ios-alert"}})],1)],1)],1)],1),e("div",{attrs:{slot:"footer"},slot:"footer"},[e("Button",{staticStyle:{"margin-left":"8px"},on:{click:function(e){return t.handleCancel()}}},[t._v("取消")]),e("Button",{attrs:{type:"primary"},on:{click:function(e){return t.handleSubmit("editTaskForm")}}},[t._v("\n        提交\n      ")])],1)],1),e("Modal",{attrs:{"footer-hide":!0,"mask-closable":!1,title:t.EditScriptModal.Title,fullscreen:!0},model:{value:t.EditScriptModal.Show,callback:function(e){t.$set(t.EditScriptModal,"Show",e)},expression:"EditScriptModal.Show"}},[e("quantum-scripts",{ref:"taskEditScripts",on:{"save-success":t.onEditScriptSave}})],1)],1)},i=[],o=(a("28a5"),a("7f7f"),a("ac6a"),a("66df")),r=function(t){return o["a"].request({url:"/api/OpenTriggerTask",params:t,method:"get"})},s=function(t){return o["a"].request({url:"/api/OpenTriggerTask",data:t,method:"post"})},l=function(t){return o["a"].request({url:"/api/OpenTriggerTask",data:t,method:"delete"})},c=function(t){return o["a"].request({url:"/api/OpenTriggerTask/Disable",data:t,method:"put"})},u=function(t){return o["a"].request({url:"/api/OpenTriggerTask/Enable",data:t,method:"put"})},d=(a("7087"),a("f121")),p=a("0f37"),m=a("5c9e"),h={data:function(){var t=this;return{HttpMethods:[{Key:"GET",Value:"GET"},{Key:"POST",Value:"POST"}],ScriptSubDir:"open-trigger-task",taskGroups:[],EditScriptModal:{Show:!1,title:"修改外触内执任务"},BaseUrl:"",TaskColumns:[{type:"selection",width:60,align:"center",fixed:"left"},{title:"名称",key:"Name",resizable:!0,width:160,ellipsis:!0,fixed:"left"},{title:"密钥",key:"Secret",ellipsis:!0,minWidth:240},{title:"请求方法",key:"HttpMethod",ellipsis:!0,minWidth:90},{title:"执行脚本",resizable:!0,key:"SrciptFile",minWidth:280,ellipsis:!0,render:function(e,a){return e("div",[e("a",{on:{click:function(){t.eidtScripts(a.row)}}},a.row.SrciptFile)])}},{title:"状态",resizable:!0,align:"center",key:"Enable",width:80,render:function(t,e){return t("div",[t("span",{style:{color:e.row.Enable?"green":"red"}},e.row.Enable?"启用":"禁用")])}},{title:"消息推送",key:"EnablePush",resizable:!0,align:"center",width:90,render:function(t,e){return t("div",[t("span",{style:{color:e.row.EnablePush?"green":"red"}},e.row.EnablePush?"是":"否")])}},{title:"代理",resizable:!0,key:"EnableProxy",width:80,align:"center",render:function(t,e){return t("div",[t("span",{style:{color:e.row.EnableProxy?"green":"red"}},e.row.EnableProxy?"启用":"禁用")])}},{title:"操作",key:"action",width:80,resizable:!0,align:"center",fixed:"right",render:function(e,a){var n=[];return n.push(e("i",{class:"fa fa-pencil",style:{color:"#ff6a00"},on:{click:function(){t.editTask(a.index)}}})),n.push(e("i",{class:"fa fa-trash",style:{color:"#f00"},on:{click:function(){t.delete([a.row.Id])}}})),e("div",n)}}],FileNameDir:"quantum",UploadHeaders:{Authorization:""},QueryForm:{PageIndex:1,PageSize:15,Enable:void 0},PageInfo:{Total:0,PageSizeOpts:[15,50,100]},AllEnums:{},QLPanels:[],CommadnData:[],EditTaskModal:{Show:!1,Title:"添加外触内执",Data:{Enable:!0,EnablePush:!1,EnableProxy:!1,SrciptFile:""}},onEditScriptSave:function(){},SelectAllQL:!0,ruleValidate:{Name:[{required:!0,message:"名称不能为空",trigger:"blur"}],HttpMethod:[{required:!0,message:"触发方式不能为空",trigger:"blur"}],Secret:[{required:!0,message:"密钥不能为空",trigger:"blur"},{min:12,message:"密钥长度不能少于12个字符",trigger:"blur"},{max:30,message:"密钥长度不能超过30个字符",trigger:"blur"}],SrciptFile:[{required:!0,message:"执行脚本不能为空",trigger:"blur"}]}}},components:{QuantumScripts:m["a"]},computed:{getTriggerUrl:function(){return window.location.origin+"/API/OpenTriggerTask/"+(this.EditTaskModal.Data.Secret||"")}},methods:{exportTask:function(){window.open(this.BaseUrl+"/api/Task/Export?key="+(this.QueryForm.Key||"")+"&TaskGroupId="+(this.QueryForm.TaskGroupId||"")+"&Enable="+(void 0!=this.QueryForm.Enable?this.QueryForm.Enable:""))},disableSelection:function(){var t=this,e=[],a=this.$refs.EnvTable.getSelection();null!=a&&0!=a.length?(a.forEach((function(t){e.push(t.Id)})),c(e).then((function(){t.LoadTask()}))):this.$Message.warning("请勾选要禁用的外触内执！")},enableSelection:function(){var t=this,e=[],a=this.$refs.EnvTable.getSelection();null!=a&&0!=a.length?(a.forEach((function(t){e.push(t.Id)})),u(e).then((function(){t.LoadTask()}))):this.$Message.warning("请勾选要启用的外触内执！")},deleteSelection:function(){var t=[],e=this.$refs.EnvTable.getSelection();if(null!=e&&0!=e.length){for(var a=0;a<e.length;a++){var n=e[a];t.push(n.Id)}this.delete(t)}else this.$Message.warning("请勾选要删除的外触内执！")},taskGroupSelectChange:function(){this.LoadTask()},eidtScripts:function(t){this.EditScriptModal.Show=!0,this.EditScriptModal.Title="修改".concat(t.Name,"脚本"),this.$refs.taskEditScripts.ModalEdit=!0,this.$refs.taskEditScripts.FileName=t.SrciptFile,this.$refs.taskEditScripts.getFile()},onSuccess:function(t,e,a){this.EditTaskModal.Data.SrciptFile="".concat(this.ScriptSubDir,"/").concat(e.name)},execTask:function(t){this.$Modal.confirm({title:"执行确认",content:"确定执行选择的任务吗?",okText:"确认",cancelText:"取消",closable:!0,onOk:function(){var e=this;(void 0)(t).then((function(t){e.$Message.success("执行请求成功!")}))}})},handleSubmit:function(t){var e=this;this.$refs[t].validate((function(t){if(t){var a=JSON.parse(JSON.stringify(e.EditTaskModal.Data));a.CommunicationTypeList&&a.CommunicationTypeList.length>0&&(a.CommunicationTypes=a.CommunicationTypeList.join(",")),s(a).then((function(t){t&&(e.$Message.success(e.EditTaskModal.Title+"成功！"),e.EditTaskModal.Show=!1,e.LoadTask())}))}}))},handleCancel:function(){this.EditTaskModal.Show=!1},ImportTaskSuccess:function(t){200===t.Code?(this.$Message.success("成功导入任务".concat(t.Data,"个。")),this.LoadTask(1)):this.$Message.error("导入任务失败："+t.Message),console.log(t)},editTask:function(t){if(t>-1){if(this.EditTaskModal.Title="修改外触内执",this.EditTaskModal.Data=JSON.parse(JSON.stringify(this.CommadnData[t])),this.CommadnData[t].CommunicationTypes){this.EditTaskModal.Data.CommunicationTypeList=[];for(var e=0;e<this.CommadnData[t].CommunicationTypes.split(",").length;e++){var a=this.CommadnData[t].CommunicationTypes.split(",")[e];this.EditTaskModal.Data.CommunicationTypeList.push(parseInt(a))}}this.EditTaskModal.Data.QLPanelEnvs=[]}else this.initEditTaskModal(),this.EditTaskModal.Title="添加外触内执";this.EditTaskModal.Show=!0},initEditTaskModal:function(){this.EditTaskModal.Data={Enable:!0,EnablePush:!1,EnableProxy:!1,SrciptFile:""}},delete:function(t){var e=this;this.$Modal.confirm({title:"删除确认",content:"确定删除选择的[".concat(t.length,"]个外触内执吗？"),okText:"确认",cancelText:"取消",closable:!0,onOk:function(){l(t).then((function(t){e.LoadTask(1)}))}})},loadAllEnums:function(){var t=this;Object(p["a"])().then((function(e){t.AllEnums=e}))},pageSizeChange:function(t){this.QueryForm.PageSize=t,this.LoadTask(1)},LoadTask:function(t){var e=this;this.QueryForm.PageIndex=t,r(this.QueryForm).then((function(t){e.CommadnData=t.Data,e.PageInfo.Total=t.TotalCount}))}},mounted:function(){this.UploadHeaders.Authorization=localStorage.getItem("accessToken"),this.BaseUrl=d["a"].baseUrl.dev,this.LoadTask(1),this.loadAllEnums()}},f=h,k=(a("95d8"),a("2877")),T=Object(k["a"])(f,n,i,!1,null,null,null);e["default"]=T.exports},"5c9e":function(t,e,a){"use strict";var n=function(){var t=this,e=t._self._c;return e("div",{staticStyle:{height:"100%"}},[e("monaco-editor",{staticClass:"editor",attrs:{language:t.getLanguage,readOnly:!1,editorMounted:t.onEditorMounted},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}}),e("footer",[e("Button",{staticClass:"saveBtn",attrs:{type:"primary"},on:{click:t.saveFile}},[t._v("保存")])],1)],1)},i=[],o=(a("28a5"),a("b199")),r=a("2b77"),s={name:"quantum-scripts",data:function(){return{content:"",SelectAllQL:!0,QLPanels:[],Files:[],Languages:{".py":"python",".js":"javascript",".json":"json",".sh":"shell",".ts":"typescript"},ModalEdit:!1,FileName:""}},model:{event:"save-success"},computed:{getLanguage:function(){if(this.FileName){var t=this.FileName.split(".");return this.Languages["."+t[t.length-1]]}return"javascript"}},components:{MonacoEditor:r["a"]},methods:{getFile:function(){var t=this;Object(o["f"])({fileName:this.FileName}).then((function(e){t.content=e}))},saveFile:function(){var t=this;this.$Modal.confirm({title:"脚本编辑确认",content:"确认保存修改的脚本内容？",okText:"确定",cancelText:"取消",closable:!0,onOk:function(){Object(o["j"])({path:t.FileName,content:t.content}).then((function(e){t.$Notice.success({desc:"修改脚本文件成功"}),t.$emit("save-success")})).catch((function(e){t.$Notice.error({title:"保存脚本文件失败",desc:e})}))}})},onEditorMounted:function(t,e){window.editor=t,window.monaco=e}},mounted:function(){}},l=s,c=(a("1a87"),a("2877")),u=Object(c["a"])(l,n,i,!1,null,"0bdfa448",null);e["a"]=u.exports},7087:function(t,e,a){"use strict";a.d(e,"b",(function(){return i})),a.d(e,"c",(function(){return o})),a.d(e,"a",(function(){return r})),a.d(e,"d",(function(){return s}));var n=a("66df"),i=function(t){return n["a"].request({url:"/api/TaskGroup",params:t,method:"get"})},o=function(t){return n["a"].request({url:"/api/TaskGroup",data:t,method:"post"})},r=function(t){return n["a"].request({url:"/api/TaskGroup",data:t,method:"delete"})},s=function(t){return n["a"].request({url:"/api/TaskGroup/UpdateRepository/"+t,method:"get"})}},"95d8":function(t,e,a){"use strict";a("469e")},"9e72":function(t,e,a){},b199:function(t,e,a){"use strict";a.d(e,"g",(function(){return i})),a.d(e,"h",(function(){return o})),a.d(e,"b",(function(){return r})),a.d(e,"c",(function(){return s})),a.d(e,"d",(function(){return l})),a.d(e,"f",(function(){return c})),a.d(e,"j",(function(){return u})),a.d(e,"e",(function(){return d})),a.d(e,"i",(function(){return p})),a.d(e,"a",(function(){return m}));var n=a("66df"),i=function(t){return n["a"].request({url:"/api/Task",params:t,method:"get"})},o=function(t){return n["a"].request({url:"/api/Task",data:t,method:"post"})},r=function(t){return n["a"].request({url:"/api/Task",data:t,method:"delete"})},s=function(t){return n["a"].request({url:"/api/Task/Disable",data:t,method:"put"})},l=function(t){return n["a"].request({url:"/api/Task/Enable",data:t,method:"put"})},c=function(t){return n["a"].request({url:"/api/Task/Scripts",params:t,method:"get"})},u=function(t){return n["a"].request({url:"/api/Task/Scripts",data:t,method:"put"})},d=function(t){return n["a"].request({url:"/api/Task/ExecTask",data:t,method:"post"})},p=function(){return n["a"].request({url:"/api/Task/script-list",method:"get"})},m=function(t){return n["a"].request({url:"/api/Task/delete-scripts?fileName="+t,method:"delete"})}}}]);